<!DOCTYPE html>
<html>
<head>
	<title>DES</title>
</head>
<body >
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%" height='900' >
<style type="text/css">
svg *{
    -moz-user-select: none;
    -khtml-user-select: none;
    user-select: none;
    cursor: pointer;
}
</style>
<defs>
    <marker id="markerArrow" markerWidth="13" markerHeight="13" refX="2" refY="6"
           orient="auto">
        <path d="M2,2 L2,11 L10,6 L2,2" style="fill: #000000;" />
    </marker>
</defs>
<rect x="300" y="10" width="160" height="80" id='goal1' class='goal' style="fill:#b3b3b3;  z-index: 1; position: relative;" />
<path d="M380,90 L380,105" style="stroke: #000000; stroke-width: 2px; fill: none;marker-end: url(#markerArrow);"/>
<rect x="300" y="120" width="160" height="80" id='goal2' class='goal' style="fill:#b3b3b3;  z-index: 1; position: relative;" />
<path d="M380,200 L380,215" style="stroke: #000000; stroke-width: 2px; fill: none;marker-end: url(#markerArrow);"/>
<rect x="280" y="230" width="200" height="300"  style="fill:#ffffff; stroke: #000000;  z-index: 1; position: relative;" />
<rect x="300" y="240" width="160" height="80" id='goal3' class='goal' style="fill:#b3b3b3;  z-index: 1; position: relative;" />
<text x="360" y="360" font-family="Verdana" font-size="35" fill="black">...</text>
<rect x="300" y="390" width="160" height="80" id='goal4' class='goal' style="fill:#b3b3b3;  z-index: 1; position: relative;" />
<text x="305" y="500" font-family="Verdana" font-size="20" fill="black">Основной этап</text>
<path d="M380,528 L380,535" style="stroke: #000000; stroke-width: 2px; fill: none;marker-end: url(#markerArrow);"/>
<rect x="300" y="550" width="160" height="80" id='goal5' class='goal' style="fill:#b3b3b3;  z-index: 1; position: relative;" />
<path d="M380,630 L380,645" style="stroke: #000000; stroke-width: 2px; fill: none;marker-end: url(#markerArrow);"/>
<rect x="300" y="660" width="160" height="80" id='goal6' class='goal' style="fill:#b3b3b3;  z-index: 1; position: relative;" />
<path d="M700,280 L475,280" style="stroke: #000000; stroke-width: 2px; fill: none;marker-end: url(#markerArrow);"/>
<rect x="500" y="240" width="160" height="80" id='goal7' class='goal' style="fill:#b3b3b3;  z-index: 1; position: relative;" /> 
<text x="560" y="360" font-family="Verdana" font-size="35" fill="black">...</text>
<path d="M700,430 L475,430" style="stroke: #000000; stroke-width: 2px; fill: none;marker-end: url(#markerArrow);"/>
<rect x="500" y="390" width="160" height="80" id='goal8' class='goal' style="fill:#b3b3b3;  z-index: 1; position: relative;" />
<rect x="700" y="240" width="160" height="230" id='goal9' class='goal' style="fill:#b3b3b3;  z-index: 1; position: relative;" />
<rect x="700" y="10" width="160" height="80" id='goal10' class='goal' style="fill:#b3b3b3;  z-index: 1; position: relative;" />
<path d="M780,90 L780,225" style="stroke: #000000; stroke-width: 2px; fill: none;marker-end: url(#markerArrow);"/>
<!-- 1 -->
<rect x="10" y="10" width="120" height="50" id='bloc1' class='block' style="fill:#e6e6e6;  z-index: 2; position: relative;" onmousedown='startDrag(event)' onmousemove='drag(event)' onmouseup='endDrag(event) '/>
<text class="text1" x="20" y="25" font-family="Verdana" font-size="10" fill="black">Исходный</text>
<text class="text1" x="20" y="35" font-family="Verdana" font-size="10" fill="black">64-разрядный</text>
<text class="text1" x="20" y="45" font-family="Verdana" font-size="10" fill="black">блок данных</text>
<!-- 2 -->
<rect x="10" y="70" width="120" height="50" id='bloc2' class='block' style="fill:#e6e6e6;  z-index: 2; position: relative;" onmousedown='startDrag(event)' onmousemove='drag(event)' onmouseup='endDrag(event) '/>
<text class="text2" x="20" y="85" font-family="Verdana" font-size="10" fill="black">Начальная</text>
<text class="text2" x="20" y="95" font-family="Verdana" font-size="10" fill="black">перестановка</text>
<!-- 3 -->
<rect x="10" y="130" width="120" height="50" id='bloc3' class='block' style="fill:#e6e6e6;  z-index: 2; position: relative;" onmousedown='startDrag(event)' onmousemove='drag(event)' onmouseup='endDrag(event) '/>
<text class="text3" x="20" y="145" font-family="Verdana" font-size="10" fill="black">Раунд 1</text>
<!-- 4 -->
<rect x="10" y="200" width="120" height="50" id='bloc4' class='block' style="fill:#e6e6e6;  z-index: 2; position: relative;" onmousedown='startDrag(event)' onmousemove='drag(event)' onmouseup='endDrag(event) '/>
<text class="text4" x="20" y="215" font-family="Verdana" font-size="10" fill="black">Раунд 1б</text>
<!-- 5 -->
<rect x="10" y="270" width="120" height="50" id='bloc5' class='block' style="fill:#e6e6e6;  z-index: 2; position: relative;" onmousedown='startDrag(event)' onmousemove='drag(event)' onmouseup='endDrag(event) '/>
<text class="text5" x="20" y="285" font-family="Verdana" font-size="10" fill="black">Конечная</text>
<text class="text5" x="20" y="295" font-family="Verdana" font-size="10" fill="black">перестановка</text>
<!-- 6 -->
<rect x="10" y="340" width="120" height="50" id='bloc6' class='block' style="fill:#e6e6e6;  z-index: 2; position: relative;" onmousedown='startDrag(event)' onmousemove='drag(event)' onmouseup='endDrag(event) '/>
<text class="text6" x="20" y="355" font-family="Verdana" font-size="10" fill="black">Зашифрованный</text>
<text class="text6" x="20" y="365" font-family="Verdana" font-size="10" fill="black">64-разрядный</text>
<text class="text6" x="20" y="375" font-family="Verdana" font-size="10" fill="black">блок данных</text>
<!-- 7 -->
<rect x="10" y="410" width="120" height="50" id='bloc7' class='block' style="fill:#e6e6e6;  z-index: 2; position: relative;" onmousedown='startDrag(event)' onmousemove='drag(event)' onmouseup='endDrag(event) '/>
<text class="text7" x="20" y="425" font-family="Verdana" font-size="10" fill="black">Частичный</text>
<text class="text7" x="20" y="435" font-family="Verdana" font-size="10" fill="black">ключ 1 (48 бит)</text>
<!-- 8 -->
<rect x="10" y="480" width="120" height="50" id='bloc8' class='block' style="fill:#e6e6e6;  z-index: 2; position: relative;" onmousedown='startDrag(event)' onmousemove='drag(event)' onmouseup='endDrag(event) '/>
<text class="text8" x="20" y="495" font-family="Verdana" font-size="10" fill="black">Частичный</text>
<text class="text8" x="20" y="505" font-family="Verdana" font-size="10" fill="black">ключ 1б (48 бит)</text>
<!-- 9 -->
<rect x="10" y="550" width="120" height="50" id='bloc9' class='block' style="fill:#e6e6e6;  z-index: 2; position: relative;" onmousedown='startDrag(event)' onmousemove='drag(event)' onmouseup='endDrag(event) '/>
<text class="text9" x="20" y="565" font-family="Verdana" font-size="10" fill="black">Форматирование</text>
<text class="text9" x="20" y="575" font-family="Verdana" font-size="10" fill="black">частичных</text>
<text class="text9" x="20" y="585" font-family="Verdana" font-size="10" fill="black">ключей</text>
<!-- 10 -->
<rect x="10" y="620" width="120" height="50" id='bloc10' class='block' style="fill:#e6e6e6;  z-index: 2; position: relative;" onmousedown='startDrag(event)' onmousemove='drag(event)' onmouseup='endDrag(event) '/>
<text class="text10" x="20" y="635" font-family="Verdana" font-size="10" fill="black">Секретный</text>
<text class="text10" x="20" y="645" font-family="Verdana" font-size="10" fill="black">56-разрядый</text>
<text class="text10" x="20" y="655" font-family="Verdana" font-size="10" fill="black">ключ</text>
</svg>
<script id=myScript>
var DragTarget=null;
var Dragging =false;
var X=0;
var Y=0;
var arrBlocks=document.getElementsByClassName('block');
var arrGoals=document.getElementsByClassName('goal');
var flags=[false,false,false,false,false,false,false,false,false,false];
swapBlocks();

function startDrag(evt)
{
    if(!Dragging) 
    {
        DragTarget = evt.target;
        X=Number(evt.clientX)-Number(DragTarget.getAttribute('x'));
        Y=Number(evt.clientY)-Number(DragTarget.getAttribute('y'));
        DragTarget.setAttribute('x',Number(evt.clientX)-X);
        DragTarget.setAttribute('y',Number(evt.clientY)-Y);

        Dragging=true;
    }
}

function drag(evt)
{
    if(Dragging)
    {
        DragTarget.setAttribute('x',Number(evt.clientX)-X);
        DragTarget.setAttribute('y',Number(evt.clientY)-Y);
        textMove(DragTarget);
    }
}

function endDrag(evt)
{
    Dragging = false;
    DragTarget.setAttribute('x',Number(evt.clientX)-X);
    DragTarget.setAttribute('y',Number(evt.clientY)-Y);
    textMove(DragTarget);
    check(evt);
    if(isFinal()) alert('Завершено');
}

function check(evt){
	var arrFlags=new Array();
	for (var i = 0; i < arrBlocks.length; i++) {
		var bX=Number(arrBlocks[i].getAttribute('x'));
		var bY=Number(arrBlocks[i].getAttribute('y'));
		for (var j = 0; j < arrGoals.length; j++) {
			var gX1=Number(arrGoals[i].getAttribute('x'));
			var gY1=Number(arrGoals[i].getAttribute('y'));
			var gX2=gX1+Number(arrGoals[i].getAttribute('width'));
			var gY2=gY1+Number(arrGoals[i].getAttribute('height'));
			if (((bX>=gX1)&&(bY>=gY1))&&((bX<=gX2)&&(bY<=gY2))){
				if (arrGoals[j].id.slice(4)==arrBlocks[i].id.slice(4)){
					arrFlags.push(j);
                }
            }
		}
	}
    for (var i = 0; i < arrGoals.length; i++) {
        arrGoals[i].setAttribute('style','fill: #b3b3b3');
         flags[i]=false;
    }
    for (var i = 0; i < arrFlags.length; i++) {
        arrGoals[arrFlags[i]].setAttribute('style','fill: #99ff99');
        flags[arrFlags[i]]=true;
    }
}
function textMove(elem){
    var elemX=Number(elem.getAttribute('x'));
    var elemY=Number(elem.getAttribute('y'));
    var arrText=document.getElementsByClassName('text'+elem.id.slice(4));
    for (var i = 0; i < arrText.length; i++) {
        arrText[i].setAttribute('x',elemX+10);
        arrText[i].setAttribute('y',elemY+15+10*i);
    }
}

function swapBlocks() {
    var arrY=[10, 70, 130, 200, 270, 340, 410, 480, 550, 620];
    for (var i = 1; i <= 10; i++) {
        var elem=document.getElementById('bloc'+i);
        // var elemX=Number(elem.getAttribute('x'));
        // var elemY=Number(elem.getAttribute('y'));
        var index=Math.floor(Math.random()*arrY.length);
        if (arrY.length==1)
            index=0;
        var tmp=arrY[index];
        arrY.splice(index,1);
        elem.setAttribute('y',tmp);
        var elemY=Number(elem.getAttribute('y'));
        var arrText=document.getElementsByClassName('text'+i);
        for (var j = 0; j < arrText.length; j++) {
            arrText[j].setAttribute('y',elemY+15+10*j);
        }
    }
}

function isFinal(){
    for (var i = 0; i < flags.length; i++) {
        if (flags[i]==false) return false;
    }
    return true;
}
</script>
</body>
</html>